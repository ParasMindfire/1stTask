<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindfire Registration</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>

<body>
    <div class="mainDiv">
        <div class="modal hide">
            <div class="modal-wrapper">
                <div class="modalHeading">
                    <h4>Type Your Password To Delete it</h1>
                </div>

                <div class="modalButtons">
                    <input id="modalInput" class="modalInputClass" type="text">
                    <button class="yesButton" id="yes">Yes</button>
                    <button class="noButton" id="no">No</button>
                </div>
            </div>
        </div>

        <div class="Navyy">
            <img src="/logo.webp" alt="">
        </div>

        <div class="mainTitle">
            <div class="typewriter">
                <h1 class="heading1">Mindfire Registration Form</h1>
            </div>
        </div>

        <div id="snackbar" class="hide">Some text some message..</div>

        <div class="container">
                <form class="mainForm" id="userForm" onsubmit="return validateForm(event)">

                    <div class="commonDiv">
                        <div class="upload">
                            <div class="uploadPhoto">
                                <img class="uploadz" src="/dummy-profile-pic-male1-300x300.jpg" alt="">
                            </div>
        
                            <div class="uploadPhotoDocs">
                                <input type="file" id="myFile" name="filename" onchange = 'renderFile()'>
                                <!-- <button class="btn">Upload</button> -->

                                <br>

                                <!-- error message -->
                                <span id="file-error" class="error-message"></span>
                            </div>
                        </div>
                    </div>
        
                    <div class="paddingDiv">
                        <div class="commonDiv">
                            <div class="nameClass">
                                
                                <input type="text" id="first_name" class="nameInput" name="first_name" placeholder="First Name*">
        
                                <input type="text" id="middle_name" class="nameInput"
                                name="middle_name" placeholder="Middle Name*">
        
                                <input type="text" id="last_name" class="nameInput"
                                name="last_name" placeholder="Last Name*">

                                <br>
                                <!-- error message -->
                                <span id="name-error" class="error-message"></span>
                            </div>
                        </div>

                        <div class="commonDiv">
                            <div class="nameClass">
                                <!-- <div class="mailClass"> -->
                                    <input type="text" id="mail" class="nameInput" name="mail" placeholder="email*" onfocusout="myEmail()">

                                    <br>
                                    <!-- error message -->
                                    <span id="email-error" class="error-message"></span>

                                <!-- </div> -->
        
                                <!-- <div class="passwordClass"> -->
                                    <input type="password" id="password" class="nameInput" name="password" placeholder="password*">

                                    <br>
                                    <!-- error message -->
                                    <span id="password-error" class="error-message"></span>

                                <!-- </div> -->

                                <!-- <div class="ConfirmpasswordClass"> -->
                                    <input type="password" id="ConfirmpasswordClass" class="nameInput" name="ConfirmpasswordClass" placeholder="Confirm Password*">

                                    <br>

                                    <!-- error message -->
                                    <span id="confirm-password-error" class="error-message "></span>

                                <!-- </div> -->
                            </div>  
                        </div>



                        <div class="commonDiv">
                            <div class="address">
                                <select id="CountryList" oninput="checkCountry()">
                                    <option>--Select a Country--</option>
                                </select>
                            </div>
                        </div>

                        <div class="commonDiv">
                            <div class="address">
                                <select id="StateList" oninput="checkState()">
                                    <option>--Select a State--</option>
                                </select>
                            </div>
                        </div>

                        <div class="commonDiv">
                            <div class="address">
                                <select id="cityList">
                                    <option>--Select a city--</option>
                                </select>
                            </div>
                        </div>

                        
            
                        <div class="commonDiv">
                            <div class="genderClass">
                                <div class="commonGenderClass">
                                    <label>Gender Type*</label>
                                </div>

                                <div class="commonGenderClass">
                                    <input type="radio" class="radioClass"  name="radioBut" id="male">
                                    <label for="rad2">Male</label>
                                
                
                        
                                    <input type="radio" class="radioClass" name="radioBut" id="female">
                                    <label for="rad1">Female</label>
                              
                                
                                    <input type="radio" class="radioClass" name="radioBut" id="trans">
                                    <label for="rad3">Trans</label>
                                </div>

                                <br>
                                <!-- error message -->
                                <span id="gender-error" class="error-message "></span>
                            </div>
                            
                        </div>


                        <div class="commonDiv">
                            <div class="selectClass">
                                <label for="selectElem">What is your branch</label>
                                <select name="selectElem" id="brranch">
                                    <option value="CS">CS</option>
                                    <option value="IT">IT</option>
                                    <option value="EI">EI</option>
                                    <option value="CIVIL">CIVIL</option>
                                </select>
                            <br>

                            <!-- error message -->
                            <span id="select_error" class="error-message "></span>
                            </div>
                        </div>


                        <div class="commonDiv">
                            <div class="bday">
                                <label for="birthday">Birthday:*</label>
                                <input type="date" id="birthday" name="birthday">

                                <br>

                                <!-- error message -->
                            <span id="bday_error" class="error-message "></span>

                            </div>
                        </div>
            
            
                        <div class="commonDiv">
                            <div class="about">
                                <div>
                                    <label for="textElem">About You*</label>
                                </div>
                                
                                <div>
                                    <input name="textElem" id="textArea">
                                </div>

                                <!-- error message -->
                                <span id="text_error" class="error-message "></span>
                            </div>
                        </div>
                    
                        <div class="commonDiv">
                            <input list="ok" name="datalistID" placeholder="Preferred Domain">
                            <datalist id="ok">
                                <option value="MERN">
                                <option value="AIML">
                                <option value="DOTNET">
                            </datalist>
                        </div>
            
            
            
                        <div class="commonDiv">
                            <input type="checkbox" name="checkBox1" class="checkBoxClass" value="check1" id="agree">
                            <label for="check1">Do You Agree To The Terms And Conditions</label>

                            <br>
                            <!-- error message  -->
                            <span id="agree-error" class="error-message"></span>
                        </div>
                        
            
                        <div class="commonDiv">
                            <button type="submit" value="Submit" name="Submit" class="btn" id="submitButton"/>
                                Submit
                            </button>
                        </div>
                    </div>
                </form>



                <div class="tableContainer">
                    <h2>People</h2>
                    <table id="peopleTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>DOB</th>
                                <th>Branch</th>
                                <th>Actions</th>
                            </tr>
                        </thead>

                        <tbody>
                        </tbody>
                    </table>
                </div>
        </div>        
    </div>






     







    <script>

$(document).ready(function(){
//   console.log("hiiii Jquery")
});

        //--------------------Notification-------------------
        function openToast(message,character){
            // console.log("c",character);
            const toast=$('#snackbar');

            if(character=="safe"){
                toast.css("background-color","green")
            }else if(character=="danger"){
                toast.css("background-color","red")
            }
            toast.text("");
            toast.removeClass("hide");
            setTimeout(()=>{
                return toast.addClass("hide");
            },3000)
            toast.text(message);
        }

        // -------------------image upload-----------------

        const renderFile = () => {
            const render = document.querySelector('.uploadz')
            const file = document.querySelector('input[type=file]').files[0]
            const reader = new FileReader();
            
            
            reader.addEventListener('load' , ()=> {
                render.src = reader.result;
                openToast("Image Uploaded Successfully","safe");
            }, false)

            if(file){
                reader.readAsDataURL(file);
            }
        }

        // -----------------Address-------------------

        const countries=[
            {
                id:0,
                country:"India",
                states:[
                    {
                        idz:0,
                        state:"Odisha",
                        cities:[
                            {
                                idt:0,
                                city:"Bhubaneswar",
                            },{
                                idt:1,
                                city:"Cuttack",
                            },{
                                idt:2,
                                city:"Chandikhole"
                            }
                        ]
                    },{
                        idz:1,
                        state:"Maharastra",
                        cities:[
                            {
                                idt:0,
                                city:"Mumbai",
                            },{
                                idt:1,
                                city:"Pune",
                            },{
                                idt:2,
                                city:"Nagpur"
                            }
                        ]
                    },{
                        idz:2,
                        state:"Jharkhand",
                        cities:[
                            {
                                idt:0,
                                city:"Dhanbad",
                            },{
                                idt:1,
                                city:"Jamshedpur",
                            },{
                                idt:2,
                                city:"Ranchi"
                            }
                        ]
                    }
                ]
            },{
                id:1,
                country:"America",
                states:[
                    {
                        idz:0,
                        state:"Texas",
                        cities:[
                            {
                                idt:0,
                                city:"Houston",
                            },{
                                idt:1,
                                city:"Dallas",
                            },{
                                idt:2,
                                city:"Austin"
                            }
                        ]
                    },{
                        idz:1,
                        state:"New Mexico",
                        cities:[
                            {
                                idt:0,
                                city:"Albuquerque",
                            },{
                                idt:1,
                                city:"Santa fe",
                            },{
                                idt:2,
                                city:"Silver City"
                            }
                        ]
                    },{
                        idz:2,
                        state:"California",
                        cities:[
                            {
                                idt:0,
                                city:"Los Angeles",
                            },{
                                idt:1,
                                city:"San Fransisco",
                            },{
                                idt:2,
                                city:"San diego"
                            }
                        ]
                    }
                ]
            },{
                id:2,
                country:"Pakistan",
                states:[
                    {
                        idz:0,
                        state:"Punjab",
                        cities:[
                            {
                                idt:0,
                                city:"Lahore",
                            },{
                                idt:1,
                                city:"Multan",
                            },{
                                idt:2,
                                city:"Faisalabad"
                            }
                        ]
                    },{
                        idz:1,
                        state:"Balochistan",
                        cities:[
                            {
                                idt:0,
                                city:"Quetta",
                            },{
                                idt:1,
                                city:"Turbat",
                            },{
                                idt:2,
                                city:"Chaman"
                            }
                        ]
                    },{
                        idz:2,
                        state:"Sindh",
                        cities:[
                            {
                                idt:0,
                                city:"Karachi",
                            },{
                                idt:1,
                                city:"Hyderabad",
                            },{
                                idt:2,
                                city:"Larkana"
                            }
                        ]
                    }
                ]
            } 
        ]

        
        const countryList=$("#CountryList")

        for(let i=0;i<countries.length;i++){
            var option = $("<option></option>").text(countries[i].country);
            countryList.append(option);
        }

        var globalCountryVariable;

        function checkCountry(){

            const statesToDisplay=$("#StateList").html(null);

            const citiesToDisplay=$("#cityList").html(null)


            let stateText=$("#StateList");
            var optionn=$("<option></option>").text("Select A State")
            stateText.append(optionn);

            let cityText=$("#cityList");
            var option=$("<option></option>").text("Select A City")
            cityText.append(option);

            const countrySelected=$("#CountryList").val();

            const filteredCountry=countries.find((c)=>{
                return c.country==countrySelected;
            })

            let states=filteredCountry.states;
            globalCountryVariable=filteredCountry.id;

            for(let i=0;i<states.length;i++){
                const statesToDisplay=$("#StateList")
                var option=$("<option></option>").text(states[i].state)
                statesToDisplay.append(option);
            }
        }




        function checkState(){
            //clearing all the options
            const citiesToDisplay=$("#cityList").html(null);

            let cityText=$("#cityList");
            var option=$("<option></option>").text("Select a city");
            cityText.append(option);


            const stateSelected=$('#StateList').val();

            const filteredState=countries[globalCountryVariable].states.find((e)=>{
                return e.state==stateSelected;
            })

            let citiezz=filteredState.cities;

            for(let i=0;i<citiezz.length;i++){
                const cityToDisplay=$('#cityList');
                var option=$('<option></option>').text(citiezz[i].city)
                cityToDisplay.append(option);
            }
        }
        

        


    



        // ------------------FORM VALIDATION---------------------------


        function validateForm(event) {

            event.preventDefault();

            // console.log("lala",peopleArray.length);

            const fileName=$("#myFile");
            const fname = $("#first_name").val();
            const mname = $("#middle_name").val();
            const lname = $("#last_name").val();  
            const email = $("#mail").val();
            const pass = $("#password").val();
            const confirmPass = $("#ConfirmpasswordClass").val();
            const select=$(".selectClass").val();
            const confirmBday = $("#birthday").val();
            const aboutU = $("#textArea").val();
            const agree = $("#agree").is(':checked');


            const fileErr=$("#file-error").text("")
            const nameErr = $("#name-error").text("");
            const emailErr = $("#email-error").text("");
            const passErr = $("#password-error").text("");
            const ConfirmPassErr = $("#confirm-password-error").text("");
            const genError = $("#gender-error").text("");
            const agreeErr =$("#agree-error").text("");
            const bdayErr=$("#bday_error").text("");
            const textErr=$("t#ext_error").text("");


            // console.log("lennn ",fileName[0].files);
            if(fileName[0].files.length==0){
                fileErr.text("You Should Upload a file");
            }

            if ((fname=="" && mname=="" && lname=="") || /\d/.test(name)) {
                nameErr.text("Name Can not be Empty");
            }

            if (email === "" || !email.includes("@") || !email.includes(".")) {
                emailErr.text("Please enter a valid email address.");
            }

            if (pass === "" || pass.length < 6) {
                passErr.text("Please enter a password with at least 6 characters.");
            }

            if (confirmPass === "" || confirmPass.length < 6 || confirmPass!=pass) {
                ConfirmPassErr.text("Confirmed Password is wrong");
            }

            if (male.checked==false && female.checked==false && trans.checked==false) {
                genError.text("Choose one gender");
            }

            if(confirmBday==""){
                bdayErr.text("Enter Your Birthday");
            }

            if(aboutU==""){
                textErr.text("About Section Can not be empty");
            }

            if (!agree) {
                agreeErr.text("Please agree to the above information.");
            }

            setTimeout(()=>{
                fileErr.text(null);
                nameErr.text(null);
                emailErr.text(null);
                passErr.text(null);
                ConfirmPassErr.text(null);
                genError.text(null);
                bdayErr.text(null);
                textErr.text(null);
                agreeErr.text(null);
            },3000);
        }



    // email vlidation

    function myEmail() {

        const email = $("#mail").val();
        const emailErr = $("#email-error");

        emailErr.text("");

        if (email === "" || !email.includes("@") || !email.includes(".")) {
            emailErr.text("Please include @");
        }

    }






    // ---------------------------tABLE---------------------

    // const form=document.getElementById('userForm');
    // const table=document.getElementById('peopleTable').querySelector('tbody');

    const form=$('#userForm');
    const tablez=$('#peopleTable');
    const table=tablez.find('tbody')

    const peopleArray=[];

    let idz=-1;

    let toEdit=null;

    var tr=[];

    var submit=true;

    form.submit((event)=>{

        event.preventDefault();

        // const fname = document.getElementById("first_name").value;
        // const branch = document.getElementById("brranch").value;
        // const email = document.getElementById("mail").value;
        // const confirmBday = document.getElementById("birthday").value;
        // const passw=document.getElementById("password").value;

        const fname = $("#first_name").val();
        const branch = $("#brranch").val();
        const email = $("#mail").val();
        const confirmBday = $("#birthday").val();
        const passw=$("#password").val();

        let tempEmail=peopleArray.find((people)=>{
            return people.email==email;
        })

        if(tempEmail){
            openToast("Email Already Exist","danger")
        }else if(fname && branch && email && confirmBday){
            var message="Form Created Successfully";

            if(submit){

                openToast(message,"safe")

                idz+=1;

                event.preventDefault();

                const tempObj={
                    id:idz,
                    name:fname,
                    branch:branch,
                    email:email,
                    birthday:confirmBday,
                    password:passw
                }

                peopleArray.push(tempObj);

                // console.log(peopleArray);

                // tr[idz] = document.createElement('tr');  
                tr[idz]=$("<tr></tr>")
                
                var curRow=tr[idz];

                // var td1 = document.createElement('td');
                // var td2 = document.createElement('td');
                // var td3 = document.createElement('td');
                // var td4 = document.createElement('td');
                // var td5 = document.createElement('td');

                var td1 = $("<td></td>")
                var td2 = $("<td></td>");
                var td3 = $("<td></td>");
                var td4 = $("<td></td>");
                var td5 = $("<td></td>");


                //There is no jQuery for createTextNode we have to use document ~ stackoverflow
                var text1 = document.createTextNode(fname);
                var text2 = document.createTextNode(email);
                var text3 = document.createTextNode(confirmBday);
                var text4 = document.createTextNode(branch);
                

                // var editButton=document.createElement('button');
                // editButton.classList.add('button');
                // editButton.innerText='Edit';
                // editButton.addEventListener('click',()=>editRow(curRow,idz));

                var editButton=$('<button></button>').addClass('button').text("Edit").click(()=>editRow(curRow,idz));

                // var deleteButton=document.createElement('button');
                // deleteButton.classList.add('button','delete');
                // deleteButton.innerText='Delete';
                // deleteButton.addEventListener('click',()=>deleteRow(curRow));

                var deleteButton=$('<button></button>').addClass('button').addClass('delete').text("Delete").click(()=>deleteRow(curRow));


                for (var i = 0; i < 4; i++){
                    td1.append(text1);
                    td2.append(text2);
                    td3.append(text3);
                    td4.append(text4);
                    td5.append(editButton);
                    td5.append(deleteButton);

                    tr[idz].append(td1);
                    tr[idz].append(td2);   
                    tr[idz].append(td3);
                    tr[idz].append(td4); 
                    tr[idz].append(td5);
                } 

                table.append(tr[idz]);
            }else{

                // console.log(tr[toEdit].cells[0].innerText+" "+tr[toEdit].cells[1].innerText);
                let currObj=peopleArray[toEdit];

                // console.log("Haha",peopleArray[toEdit]);

                // const fname = document.getElementById("first_name").value;
                // const branch = document.getElementById("brranch").value;
                // const email = document.getElementById("mail").value;
                // const confirmBday = document.getElementById("birthday").value;

                const fname = $("f#irst_name").val();
                const branch = $("#brranch").val();
                const email = $("#mail").val();
                const confirmBday =$("#birthday").val();


                // tr[toEdit].cells[0].innerText=fname;
                // tr[toEdit].cells[1].innerText=email;
                // tr[toEdit].cells[2].innerText=confirmBday;
                // tr[toEdit].cells[3].innerText=branch;

                console.log("howw",tr[toEdit]);

                // tr[toEdit][0].cells[0].text(fname);
                // tr[toEdit][0].cells[1].text(email);
                // tr[toEdit][0].cells[2].text(confirmBday);
                // tr[toEdit][0].cells[3].text(branch);
            

                document.getElementById('submitButton').innerText = 'Submit';
                $('#submitButton').text('Submit');

                submit=true;

                openToast("Form Edited Successfully","safe")
            }
        }else{  
            message="Add Required Fileds before submitting"
            openToast(message,"danger")
        }

        form.trigger("reset");

    })



    function editRow(row,id) {
        console.log("row",row[0])
        let toFindEmail=row[0].cells[1].innerText;

        const findobj=peopleArray.find((e)=>{
            return e.email==toFindEmail;
        })

        // console.log("obj",findobj);
        // console.log("row",row[0].cells[1].innerText);
        // console.log("id",id);

        toEdit=findobj.id;
        submit=false;
        document.getElementById('submitButton').innerText = 'Edit';
        document.getElementById('first_name').value = row[0].cells[0].innerText;
        document.getElementById('mail').value = row[0].cells[1].innerText;
        document.getElementById('birthday').value = row[0].cells[2].innerText;
        document.getElementById('brranch').value = row[0].cells[3].innerText;
        
    }

    function deleteRow(row) {
        openModal(row);
        // row.remove();
    }

    function openModal(row){
        const modal = document.getElementsByClassName("modal")[0];

        modal.classList.remove("hide");
        const yesBtn=document.getElementById('yes');
        const noBtn=document.getElementById('no');

        yesBtn.addEventListener('click',()=>{
            const pass=document.getElementById('modalInput').value;

            let toFindEmail=row.cells[1].innerText;

            const findobj=peopleArray.find((e)=>{
                return e.email==toFindEmail;
            })

            console.log("password typed ",pass);
            console.log("password actual ",findobj.password);

            if(pass==findobj.password){
                row.remove();
                modal.classList.add("hide");
                message="Record Deleted Successfully";
                const toDel=peopleArray.find((people)=>people.email==toFindEmail);
                peopleArray[toDel.id]={};
                openToast(message,"safe")
            }else{
                openToast("Enter The Password Correctly","danger")
            }
  
        })

        noBtn.addEventListener('click',()=>{
            modal.classList.add("hide");
        })


    }



    </script> 


</body>

</html>